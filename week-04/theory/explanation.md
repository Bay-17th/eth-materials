# 4주차: Network/Block 상세 설명

블록, 체인, MPT, 그리고 P2P 네트워크를 처음 배우는 분들을 위한 상세 설명입니다.

---

## 1. 비유로 시작하기

블록체인을 이해하는 가장 쉬운 방법은 **레고 블록**을 떠올리는 것입니다.

### 레고 블록처럼 생각하기

1. **레고 블록 하나** = 이더리움의 **블록** 하나
2. **여러 블록을 연결** = **블록체인**
3. **각 블록에는 정보가 담김** = **트랜잭션들**

> 레고처럼 블록들이 딱 맞물려서 연결되어 있어요.
> 중간에 하나를 빼면 전체 구조가 무너지죠!

---

## 2. 블록 = 거래 묶음

### 블록이란?

**블록(Block)**은 여러 개의 트랜잭션을 하나로 묶은 것입니다.

**비유:** 택배 상자
- 여러 물건(트랜잭션)을 하나의 상자(블록)에 담습니다
- 상자에는 배송 정보(헤더)가 적혀 있습니다
- 상자들은 순서대로 쌓입니다

### 왜 묶나요?

만약 트랜잭션을 하나씩 처리하면:
- 네트워크 부하가 심해집니다
- 합의가 너무 자주 필요합니다

블록으로 묶으면:
- 여러 트랜잭션을 한 번에 처리
- 효율적인 합의 가능

### 블록의 구성 요소

| 구성 요소 | 내용 | 비유 |
|-----------|------|------|
| **블록 헤더** | 메타데이터 (부모 해시, 상태 루트 등) | 택배 송장 |
| **트랜잭션 목록** | 실제 거래들 | 택배 내용물 |

---

## 3. 체인 = 블록 연결 (부모 해시)

### 블록들은 어떻게 연결되나요?

각 블록은 **이전 블록의 해시값(parentHash)**을 가지고 있습니다.

```
블록 1의 해시: 0xabc123...
블록 2의 parentHash: 0xabc123... (블록 1을 가리킴)
블록 2의 해시: 0xdef456...
블록 3의 parentHash: 0xdef456... (블록 2를 가리킴)
```

### 왜 이렇게 하나요?

**해시는 내용의 지문**입니다:
- 내용이 조금만 바뀌어도 해시가 완전히 달라집니다
- 블록 1을 수정하면 → 해시 변경 → 블록 2의 parentHash와 불일치!

**결론:** 과거 블록을 수정하려면 그 이후 **모든 블록**을 다시 만들어야 합니다.

> 이것이 블록체인이 **변조 방지**되는 핵심 원리입니다!

### 블록 헤더의 주요 필드

| 필드 | 설명 | 쉬운 비유 |
|------|------|-----------|
| **parentHash** | 이전 블록 해시 | 이전 택배 송장번호 |
| **stateRoot** | World State 루트 | 전화번호부 목차 |
| **transactionsRoot** | 트랜잭션들의 루트 | 내용물 목록 |
| **receiptsRoot** | 실행 결과들의 루트 | 배송 결과 기록 |
| **number** | 블록 높이 | 층수 |
| **timestamp** | 생성 시간 | 배송 날짜 |

---

## 4. MPT = 주소록 + 보안 (3단계 설명)

### MPT(Merkle Patricia Trie)란?

1주차에서 **World State**를 배웠죠? "모든 계정의 현재 상태"를 담고 있는 거대한 데이터베이스요.

이 데이터를 저장하는 방식이 바로 **MPT**입니다.

### 1단계: Trie (트라이)

**Trie**는 단어를 저장하는 트리 구조입니다.

**비유:** 사전 찾기
- "dog"을 찾으려면: d → o → g 순서로 따라감
- "dot"을 찾으려면: d → o → t 순서로 따라감
- "d → o" 까지는 같은 경로를 공유!

**특징:**
- 공통 접두사를 공유해서 효율적
- 검색 속도: 키의 길이만큼만 필요

### 2단계: Patricia Trie (경로 압축)

일반 Trie의 문제: 긴 키에 노드가 너무 많아집니다.

**Patricia Trie 해결책:**
- 중간에 분기가 없는 경로를 **압축**
- `a → b → c → d` 대신 `abcd` 하나로!

**비유:** 주소 단축
- "서울특별시 강남구 테헤란로 123번길 45"
- → "강남 테헤란로 123-45" (줄여도 알 수 있음)

### 3단계: Merkle Trie (해시 검증)

**Merkle Tree** 아이디어를 추가합니다:
- 각 노드의 해시 = 자식 노드들의 해시를 조합
- **루트 해시** 하나만 알면 전체 무결성 확인!

**비유:** 봉인된 상자
- 상자 안에 상자, 그 안에 또 상자
- 가장 바깥 봉인만 확인하면 내부 변조를 알 수 있음

### MPT의 3가지 노드 타입

| 노드 타입 | 역할 | 비유 |
|-----------|------|------|
| **Extension** | 공통 경로 압축 | 고속도로 |
| **Branch** | 16개 분기점 | 교차로 |
| **Leaf** | 실제 데이터 | 목적지 |

### 왜 MPT를 사용하나요?

1. **빠른 검색:** 주소로 계정을 빠르게 찾습니다
2. **공간 절약:** Patricia 압축으로 저장 효율 향상
3. **변조 방지:** Merkle 해시로 무결성 보장
4. **Light Client 지원:** 전체 데이터 없이도 검증 가능

---

## 5. P2P 네트워크 = 친구들끼리 전달

### P2P란?

**P2P(Peer-to-Peer)**는 중앙 서버 없이 참여자들이 직접 연결되는 방식입니다.

**비유:** 친구들끼리 전화하기

**중앙화 방식:**
```
모든 전화 → 전화국 → 상대방
전화국이 다운되면? 아무도 통화 못함!
```

**P2P 방식:**
```
나 ↔ 친구1 ↔ 친구2 ↔ ...
한 명이 빠져도 다른 경로로 통화 가능!
```

### 이더리움 노드 종류

| 노드 타입 | 저장 데이터 | 누가 쓰나요? |
|-----------|-------------|--------------|
| **Full Node** | 최근 블록 + 현재 상태 | 일반 검증자 |
| **Light Node** | 블록 헤더만 | 지갑 앱, 모바일 |
| **Archive Node** | 모든 역사적 상태 | 블록 탐색기, 분석가 |

**팁:** 일반 사용자는 Light Node면 충분합니다!

### 블록이 퍼지는 과정

1. **검증자**가 새 블록을 생성합니다
2. 연결된 **피어들**에게 블록을 전송합니다
3. 각 노드는 블록을 **검증**합니다
4. 유효하면 **저장**하고 다른 피어에게 **전파**합니다

> 마치 뉴스가 친구에서 친구로 퍼지는 것과 같아요!

---

## 6. 보안 주의: 네트워크 공격

### Eclipse Attack (이클립스 공격)

**무엇인가요?**
- 공격자가 피해자 노드의 **모든 연결**을 장악
- 피해자는 **가짜 블록체인** 정보만 받게 됨

**비유:** 가짜 뉴스만 듣기
- 모든 뉴스 채널이 공격자에게 장악됨
- 진짜 뉴스를 받을 수 없음

**방어 방법:**
- **다양한 피어**와 연결 유지
- **신뢰할 수 있는 부트노드** 사용
- 지역/운영자가 다른 노드들과 연결

### 51% Attack (51퍼센트 공격)

**무엇인가요?**
- 네트워크의 **과반 이상** 파워를 확보
- 자신만의 **비밀 체인**을 만들어 기존 체인 교체

**가능한 위험:**
- 이중 지불 (같은 돈을 두 번 사용)
- 특정 트랜잭션 검열
- 블록 재조직

**현실에서는?**
- 비트코인, 이더리움 같은 큰 네트워크에서는 **사실상 불가능**
- 엄청난 비용이 필요하기 때문

**방어:**
- 네트워크 분산화 유지
- 충분한 참여자 확보
- 지속적인 모니터링

---

## 7. 핵심 요약

1. **블록 = 트랜잭션 묶음**
   - 헤더(메타데이터) + 바디(트랜잭션들)
   - 효율적인 처리와 합의를 위해

2. **체인 = parentHash로 연결**
   - 이전 블록 해시를 저장
   - 변조 시 모든 후속 블록에 영향

3. **MPT = Trie + Patricia + Merkle**
   - 빠른 검색 (Trie)
   - 공간 절약 (Patricia)
   - 변조 방지 (Merkle)

4. **P2P = 탈중앙 네트워크**
   - 중앙 서버 없음
   - 노드 종류: Full, Light, Archive

5. **보안 위협**
   - Eclipse Attack: 노드 격리
   - 51% Attack: 과반 파워 장악
   - 방어: 다중 연결 + 분산화

---

## 8. 다음 단계

### 이 주의 다른 자료

- [slides.md](./slides.md) - 발표용 슬라이드
- [용어 사전](../../resources/glossary.md) - 이번 주 핵심 용어

### 다음 주 예고

**5주차: PoS/Consensus**

- 합의 메커니즘이란?
- PoW vs PoS 차이
- 검증자(Validator)의 역할
- RANDAO와 슬래싱

### 더 알고 싶다면

- [Ethereum.org - Blocks](https://ethereum.org/developers/docs/blocks)
- [Ethereum.org - Networking Layer](https://ethereum.org/developers/docs/networking-layer)
- [Understanding MPT](https://ethereum.org/developers/docs/data-structures-and-encoding/patricia-merkle-trie)

---

## 용어 정리

| 용어 | 설명 |
|------|------|
| Block | 여러 트랜잭션을 묶은 데이터 단위 |
| Block Header | 블록의 메타데이터 (해시, 루트 등) |
| parentHash | 이전 블록의 해시값 |
| Chain | parentHash로 연결된 블록들의 시퀀스 |
| MPT | Merkle Patricia Trie (효율적 데이터 구조) |
| Trie | 키를 문자 단위로 저장하는 트리 |
| Patricia | 경로 압축으로 공간 절약 |
| Merkle | 해시를 이용한 무결성 검증 |
| P2P | Peer-to-Peer (중앙 서버 없는 네트워크) |
| Full Node | 전체 블록과 상태를 저장하는 노드 |
| Light Node | 헤더만 저장하는 경량 노드 |
| Eclipse Attack | 노드 격리 공격 |
| 51% Attack | 과반 파워 장악 공격 |

> 더 많은 용어는 [용어 사전](../../resources/glossary.md)을 참고하세요!
